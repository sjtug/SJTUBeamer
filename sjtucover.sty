%%
%% This is file `sjtucover.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% sjtucover.dtx  (with options: `package,maxplus,max,min,my')
%% ------------------------------------------------------------------------
%% Copyright (C) Shanghai Jiao Tong University
%% The definition in this file is referred to the Visual Identity System
%% from Shanghai Jiao Tong University (SJTU).
%% See https://vi.sjtu.edu.cn for more information.
%% 
%% SJTUG implements the design but doesn't hold the copyright.
%% Any commercial usage in this file should be acknowledged by
%% the administration of SJTU.
%% More infomation about the license,
%% see https://vi.sjtu.edu.cn/index.php/articles/bulletin/16.
%% ------------------------------------------------------------------------
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{sjtucover}[2022/03/21 cover library for sjtubeamer v2.5.7]
\RequirePackage{sjtuvi}
\DefineOption{cover}{lang}{cn}
\DefineOption{cover}{lang}{en}
\@ifclassloaded{ctexbeamer}{\ExecuteOptionsBeamer{cn}}{
  \ExecuteOptionsBeamer{en}}
\ProcessOptionsBeamer
\defbeamertemplate*{logo}{max}{\resizebox{!}{1cm}{\sjtubadge}}
\if\EqualOption{cover}{lang}{cn}
  \defbeamertemplate*{logo}{default}{\resizebox{!}{0.7cm}{\cnlogo}}
\else
  \defbeamertemplate*{logo}{default}{\resizebox{!}{0.7cm}{\enlogo}}
\fi
\defbeamertemplate*{titlegraphic}{maxplus}{\includegraphics{vi/sjtuphoto.jpg}}
\defbeamertemplate*{titlegraphic}{max}{\sjtubg[opacity=0.2]}
\defbeamertemplate*{titlegraphic}{min}{\includegraphics{vi/sjtuphoto.jpg}}
\defbeamertemplate*{titlegraphic}{my}{
  %
  % Developer could define your title graphic here for "my"...
  %
}
\defbeamertemplate*{title page}{maxplus}[1][]
{
  \nointerlineskip%
  \vbox{}
  \vfill
  \begingroup
  \usebeamercolor{palette primary}%
  \begin{tikzpicture}[overlay,
      xshift=-0.12\paperwidth,
      yshift=-0.53\paperheight]
    \pgfmathsetlengthmacro{\outslant}{1.02\paperwidth}
    \node[inner sep=0, outer sep=0]
      at (0.57\paperwidth,0.5\paperheight){
        \resizebox{!}{1.06\paperheight}{\vphantom{-}\inserttitlegraphic}};
    \fill[color=white] (0,0) rectangle(1.1\paperwidth,3.9);
    \fill[color=bg]  (0,-0.1\paperheight) rectangle(1.1\paperwidth,3.88);
    \node[anchor=north west, text width=.8\paperwidth]
    at (0.11\paperwidth,3.6){%
    \usebeamercolor[fg]{title}
    \ifx\insertsubtitle\@empty%
      {\huge\bfseries\inserttitle}\\
      \else%
      {\Large\bfseries\inserttitle}\\
      {\small\insertsubtitle}\\
    \fi%
    };
    \node[anchor=south west, text width=.8\paperwidth] at (0.11\paperwidth,0.45){%
      {\usebeamercolor[fg]{author}\small\insertauthor\par}
        {\usebeamercolor[fg]{institute}\small\insertinstitute\par}
        {\usebeamercolor[fg]{date}\small\insertdate}%
    };
    \node[anchor=south east, inner sep=0, outer sep=0] at (\outslant,0.5){
      \usebeamercolor[fg]{palatte primary}
      \resizebox{!}{1cm}{\vphantom{-}\usebeamertemplate{logo}}
    };
  \end{tikzpicture}
  \endgroup
  \vfill
}
\defbeamertemplate*{title page}{max}[1][]
{
  \nointerlineskip
  \vbox{}
  \usebeamercolor{palette primary}
  \begin{tikzpicture}[overlay]
    \fill [palette primary.bg] (-0.2*\the\paperwidth,-1*\the\paperheight)
    rectangle (1*\the\paperwidth, 0.3*\the\paperheight);
    \node [palette primary.fg, inner sep=0pt]
    at (0.45\paperwidth-6pt,-0.4*\the\paperheight)
    {\resizebox{1.3\paperwidth}{!}{\inserttitlegraphic}};
  \end{tikzpicture}
  \vfill
  \begingroup
  \begin{beamercolorbox}[sep=8pt,#1,center]{title}
    \usebeamerfont{title}\inserttitle\par%
    \ifx\insertsubtitle\@empty%
    \else%
      \vskip0.25em%
      {\usebeamerfont{subtitle}\insertsubtitle\par}%
    \fi%
  \end{beamercolorbox}%
  \vskip1em\par
  \begin{beamercolorbox}[sep=8pt,#1,center]{author}
    \usebeamercolor[fg]{palette primary}
    \usebeamerfont{author}\insertauthor
  \end{beamercolorbox}
  \begin{beamercolorbox}[sep=8pt,#1,center]{institute}
    \usebeamercolor[fg]{palette primary}
    \usebeamerfont{institute}\normalsize\insertinstitute
  \end{beamercolorbox}
  \begin{beamercolorbox}[sep=8pt,#1,center]{date}
    \usebeamercolor[fg]{palette primary}
    \usebeamerfont{date}\insertdate
  \end{beamercolorbox}
  \endgroup
  \vfill
}
\tikzfading[
  name=center fade,
  inner color=transparent!0,
  outer color=transparent!15
]
\tikzfading[
  name=fade right,
  left color=transparent!0,
  right color=transparent!100
]
\defbeamertemplate*{title page}{min}[1][]
{
  \vbox{}
  \usebeamercolor{palette primary}
  \begin{tikzpicture}[overlay]
    \fill [palette primary.bg] (-0.2*\the\paperwidth,-1*\the\paperheight)
    rectangle (1*\the\paperwidth, 0.2*\the\paperheight);
  \end{tikzpicture}
  \ifx\sjtubeamer@compatible\sjtubeamer@compatible@false
  \else
    \ifbeamer@draftmode%
    \else%
      \begin{tikzpicture}[overlay]
        \stamparray{20pt}
        {(-0.2*\the\paperwidth,-1*\the\paperheight)}
        {(1*\the\paperwidth, 0.2*\the\paperheight)}
        \fill [bg,path fading=fade right]
        (-0.2*\the\paperwidth,-1*\the\paperheight) rectangle
        (1*\the\paperwidth, 0.2*\the\paperheight);
        \fill [bg,path fading=center fade,xshift=-10pt,yshift=-20pt]
        (0.2*\the\paperwidth,0) circle [radius=\the\paperwidth];
      \end{tikzpicture}
    \fi%
  \fi
  \vfill
  \begingroup
  \centering
  \begin{beamercolorbox}{palette primary}
    \vskip8pt
    \hbox{
      \hskip-4pt{\resizebox{!}{1cm}{\vphantom{-}\usebeamertemplate{logo}}}
      \ifx\insertinstitute\@empty%
      \else
      \ifx\insertlogo\@empty%
        \else
        {\hskip0pt \vrule width0.5pt}\hskip3pt
      \fi
      \if\EqualOption{inner}{lang}{en}
      \vbox to 1cm{
          \vfill
          \vbox{
            \offinterlineskip
            \noindent \strut
            \baselineskip 0pt \lineskip -2pt
            \scriptsize\textsc{\beamer@shortinstitute}
            \strut
          }
          \vfill
        }
      \else
      \vbox{
        \fontsize{13pt}{0pt}\selectfont
        \insertinstitute
        \par\noindent\vskip0.15em
        \fontsize{5pt}{0pt}\selectfont
        \textsc{\insertshortinstitute}
        \baselineskip 3.2pt
        \par~
      }
      \fi
      \fi%
    }
    \vskip8pt
  \end{beamercolorbox}
  \begin{beamercolorbox}[sep=8pt,#1]{title}
    \usebeamerfont{title}\inserttitle\par%
    \ifx\insertsubtitle\@empty%
    \else%
      \vskip0.25em%
      {\usebeamerfont{subtitle}\insertsubtitle\par}%
    \fi%
  \end{beamercolorbox}%
  \vskip1em\par
  \begin{beamercolorbox}[sep=8pt,#1]{author}
    \usebeamerfont{author}\insertauthor
  \end{beamercolorbox}
  \begin{beamercolorbox}[sep=8pt,#1]{date}
    \usebeamerfont{date}\insertdate
  \end{beamercolorbox}
  \usebeamercolor{palette primary}%
  \ifx\inserttitlegraphic\@empty%
  \else
    \begin{tikzpicture}[overlay,yshift=0.77em]
      \node (pic) [fg, above left] at (0.88*\the\paperwidth,0)
      {\resizebox{0.3\paperwidth}{!}{\inserttitlegraphic}};
      \draw[decoration={
            stampline,
            segment length=8pt,
            path has corners=true,
          },decorate,fg]
      (pic.north west) --
      (pic.north east) --
      (pic.south east) --
      (pic.south west) -- cycle;
    \end{tikzpicture}
  \fi
  \endgroup
  \vskip0.5em
  \vfill
}
\defbeamertemplate*{title page}{my}[1][]{
  %
  % Developer could implement your own title page template here...
  % or use "my" theme first, then implement your title page
  % in a different style file mycover.sty with:
  %    \defbeamertemplate*{title page}{<another name>}[1][]{<Your implementation>}
  %    \defbeamertemplatealias{title page}{my}{<another name>}
  % and in the main.tex:
  %    \usetheme[my]{sjtubeamer}\usepackage{mycover}
  %
}
\if\EqualOption{cover}{lang}{cn}%
  \newcommand{\bottomthanks}{谢\,谢}
\else%
  \newcommand{\bottomthanks}{Thank You}
\fi%
\tikzfading[name=fade right img,
  left color=transparent!20,
  right color=transparent!100]
\defbeamertemplate*{bottom page}{maxplus}[1][]
{
  \nointerlineskip
  \vbox{}
  \begin{tikzpicture}[overlay]
    \usebeamercolor{palette primary}
    \fill[palette primary.bg] (-0.2\paperwidth,-\paperheight)
    rectangle (\paperwidth, 0.5\paperheight);
  \end{tikzpicture}
  \vfill
  \begin{beamercolorbox}[sep=0pt]{empty}
    \usebeamercolor{structure}
    \begin{tikzpicture}[overlay,xshift=0.54\paperwidth,yshift=-0.41\paperheight]
      \begin{scope}
        \clip (-0.66\paperwidth,0.06\paperheight)
        rectangle (0.43\paperwidth,0.53\paperheight);
        \node [anchor=north] at (0,0.645\paperheight) {
          \resizebox{1.33\paperwidth}{!}{\inserttitlegraphic}};
        \fill[structure.fg!50!black,path fading=fade right img]
        (-0.66\paperwidth,0.06\paperheight)
        rectangle (0.43\paperwidth,0.53\paperheight);
        \node[white] at (-0.45\paperwidth,0.3\paperheight)
        {\resizebox{!}{0.115\paperheight}{\vphantom{-}\usebeamertemplate{logo}}};
        \draw[white] (-0.66\paperwidth,0.1\paperheight)
        -- (0.43\paperwidth,0.1\paperheight);
      \end{scope}
      \node at (-0.13\paperwidth,0.7\paperheight) {
        \usebeamercolor[fg]{title}
        \LARGE \bfseries \bottomthanks
      };
    \end{tikzpicture}
  \end{beamercolorbox}
  \vfill
}
\defbeamertemplate*{bottom page}{max}[1][]
{
  \nointerlineskip
  \vbox{}
  \usebeamercolor{palette primary}
  \usebeamercolor{structure}
  \begin{beamercolorbox}[sep=0pt]{empty}
    \begin{tikzpicture}[overlay,yshift=0.25\paperwidth]
      \def\leftw{0.215\paperwidth}
      \def\midw{0.435\paperwidth}
      \def\rightw{0.655\paperwidth}
      \fill[palette primary.bg] (-0.2\paperwidth,-1.2\paperheight) rectangle
      (\paperwidth, 0.1\paperheight);
      \fill[palette primary.fg] (\leftw,0.1\paperheight)
      -- (\leftw,-0.5\paperheight)
      -- (\midw,-0.65\paperheight)
      -- (\rightw,-0.5\paperheight)
      -- (\rightw,0.1\paperheight) -- cycle;
      \fill[palette primary.fg] (\leftw,-0.53\paperheight)
      -- (\leftw,-0.59\paperheight)
      -- (\midw,-0.74\paperheight)
      -- (\rightw,-0.59\paperheight)
      -- (\rightw,-0.53\paperheight)
      -- (\midw,-0.68\paperheight) -- cycle;
      \node[black] at (\midw,-0.65\paperheight) {
        \resizebox{1.25\paperwidth}{!}{\inserttitlegraphic}};
      \node at (\midw,-0.2\paperheight) {
        \resizebox{3cm}{!}{\hphantom{-}\usebeamertemplate{logo}}};
      \node at (\midw,-0.45\paperheight) {
        \usebeamercolor[bg]{palette primary}
        \LARGE \bfseries\bottomthanks};
    \end{tikzpicture}
  \end{beamercolorbox}
}
\defbeamertemplate*{bottom page}{min}[1][]
{
  \vbox{}
  \usebeamercolor{palette primary}
  \usebeamercolor{palette secondary}
  \begin{tikzpicture}[overlay,yshift=-80pt]
    \def\w{\the\paperwidth}%
    \def\h{\the\paperheight}%
    \fill [palette primary.bg] (-0.2*\w,-1*\h) rectangle (1*\w, 0.5*\h);
    \begin{scope}[fill=palette primary.bg!50!palette primary.fg,fill opacity=0.15]
      \clip (0.63*\w,1.05*\h) circle (1*\h);
      \fill (0.14*\w,-0.95*\h) circle (1.67*\h);
    \end{scope}
    \begin{scope}
      [fill=palette secondary.bg!50!palette primary.bg!70!palette primary.fg,
        fill opacity=0.15]
      \clip[xshift=26pt] (0.95*\w,-0.67*\h) circle (1.17*\h);
      \fill
      (0.14*\w,-0.95*\h) circle (1.67*\h)
      (0.63*\w,1.05*\h) circle (1*\h);
    \end{scope}
  \end{tikzpicture}
  \vfill
  \usebeamercolor[fg]{palette primary}
  \begingroup
  \raggedleft
  \resizebox{!}{1cm}{\vphantom{-}\usebeamertemplate{logo}}
  \vfill
  \vskip6em
  \begin{beamercolorbox}[sep=8pt]{title}
    \usebeamerfont{title}\noindent\bottomthanks
    \vskip1em%
    \usebeamerfont{subtitle}
    \insertauthor
    \ifx\insertauthor\@empty
    \else
      \ifx\inserttitle\@empty
      \else~$\cdot$~\fi
    \fi
    \inserttitle
  \end{beamercolorbox}%
  \vfill
  \vskip3.5em
  \endgroup
}
\defbeamertemplate*{bottom page}{my}[1][]
{
  %
  % Developer could implement your own bottom page template here...
  % or use "my" theme first, then implement your title page
  % in a different style file mycover.sty with:
  %    \defbeamertemplate*{bottom page}{<another name>}[1][]{<Your implementation>}
  %    \defbeamertemplatealias{bottom page}{my}{<another name>}
  % and in the main.tex:
  %    \usetheme[my]{sjtubeamer}\usepackage{mycover}
  %
}
\defbeamertemplate*{part page}{maxplus}[1][]
{
  \nointerlineskip
  \vbox{}
  \usebeamercolor{palette primary}
  \def\sjtubeamer@logocolor{palette primary.fg}
  \begin{tikzpicture}[overlay]
    \fill [palette primary.bg] (-0.2*\the\paperwidth,-1*\the\paperheight)
    rectangle (1*\the\paperwidth, 0.3*\the\paperheight);
    \node [right] at (-0.2*\the\paperwidth, -0.48*\the\paperheight) {\resizebox{1.25\paperwidth}{!}{\sjtugate}};
  \end{tikzpicture}
  \vfil
  \begingroup
    \usebeamercolor[fg]{part title}
    \usebeamerfont{part name}
    \if\EqualOption{cover}{lang}{cn}%
      第~\insertromanpartnumber~部分
    \else%
      \partname~\insertromanpartnumber
    \fi%
    \par\vskip4pt
    \usebeamerfont{part title}\insertpart\par
  \endgroup
  \vfill
}
\defbeamertemplate*{part page}{min}[1][]
{
  \vfill
  \vskip 8pt
  \begingroup
  \begin{beamercolorbox}[sep=16pt,right,#1]{part title}
    \hfill\usebeamerfont{part name}
    \if\EqualOption{cover}{lang}{cn}%
      第~\insertromanpartnumber~部分
    \else%
      \partname~\insertromanpartnumber
    \fi%
    \par\vskip4pt
    \usebeamerfont{part title}\insertpart\par
    \hbox to \textwidth{
      {
        \usebeamerfont{footline}
        \setbeamercolor{section in head/foot}{use=palette primary,
          fg=palette primary.fg,bg=}
        \let\navwidth\textwidth
        \advance\navwidth by -32pt
        \insertsectionnavigationhorizontal{\navwidth}{\hskip0pt plus1filll}{\hskip-.3cm}\hskip11pt
      }
    }
  \end{beamercolorbox}
  \endgroup
  \vfill
}
\def\sectionblock#1{
  \begin{beamercolorbox}[sep=12pt,right,#1]{section title}
    \usebeamerfont{section name}
    \if\EqualOption{inner}{lang}{cn}%
      第~\insertsectionnumber~节
    \else%
      \sectionname~\insertsectionnumber
    \fi%
    \par\vskip4pt
    \usebeamerfont{section title}\insertsection\par
  \end{beamercolorbox}
}
\defbeamertemplate*{section page}{min}[1][]
{
  \vfill
  \begingroup
  \sectionblock{#1}
  \endgroup
  \vfill
}
\defbeamertemplate*{subsection page}{min}[1][]
{
  \vfill
  \begingroup
  \sectionblock{#1}
  \begin{beamercolorbox}[sep=8pt,right,#1]{subsection title}
    \usebeamerfont{subsection name}
    \if\EqualOption{inner}{lang}{cn}%
    第~\insertsubsectionnumber~小节
    \else%
    \subsectionname~\insertsubsectionnumber
    \fi%
    \par\vskip 4pt
    \usebeamerfont{subsection title}\insertsubsection\par
  \end{beamercolorbox}
  \endgroup
  \vfill
}
\endinput
%%
%% End of file `sjtucover.sty'.
